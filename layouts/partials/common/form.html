<h1 class="title">{{ default .title (T .title) | markdownify }}</h1>
{{ $method := default "POST" .method }}
<form class="form is-vibe-form" method="{{ $method }}" action="{{ .action }}">
  {{ range .controls }}
  <div class="columns">
    {{ range . }}
    <div class="column{{ with .column_class }} {{ . }}{{ end }}">
      <div class="control{{ if .annotation }} annotated{{ end }}">
        {{ if .dropdown }}
        <div class="select is-fullwidth">
          <select name="{{ .name }}"
                  class="placeholder"
                  {{ if .required }}required{{ end }}
                  >
            <option value="" disabled selected>{{ default .placeholder (T .placeholder) }}</option>
            {{ range .dropdown }}
              {{ if reflect.IsMap . }}
                <option value="{{ .value }}">{{ .text }}</option>
              {{ else }}
                <option>{{ . }}</option>
              {{ end }}
            {{ end }}
          </select>
        </div>
        {{ else if eq .type "textarea" }}
        <textarea name="{{ .name }}"
                  class="textarea{{ with .class }} {{ . }}{{ end }}"
                  placeholder="{{ default .placeholder (T .placeholder) }}"
                  {{ if .required }}required{{ end }}
                  ></textarea>
        {{ else }}
        {{ $type := default "input" .type }}
        {{ $class := default "input" .class }}
        <input name="{{ .name }}"
               class="{{ $class }}"
               type="{{ $type }}"
               placeholder="{{ default .placeholder (T .placeholder) }}"
               value="{{ .value }}"
               {{ if .required }}required{{ end }}
               />
        {{ end }}

        {{ with .annotation }}
          <div class="annotation-icon">
            {{ (resources.Get .icon).Content | safeHTML }}
          </div>
          <div class="annotation-content">
            {{ range .content }}
            {{ if .text }}
            <div class="annotation-text">
              {{ .text }}
            </div>
            {{else if .figure}}
            <div class="annotation-figure">
              <figure class="image">
                {{ partial "common/srcset" (dict "resource" (resources.Get .figure) "desktop" "1280x" "tablet" "960x" "mobile" "750x" "options" "jpg") }}
              </figure>
            </div>
            {{ end }}
            {{ end }}
          </div>
        {{ end }}
      </div>
    </div>
    {{ end }}
  </div>
  {{ end }}
  {{ with .privacy }}
  <div class="privacy left-align">
    {{ . | markdownify }}
  </div>
  {{ else }}
  <div class="privacy">
    Read our <a href="/privacy/" target="_blank">Privacy Policy</a>
  </div>
  {{ end }}

  <div class="columns is-buttons">
    {{ range .buttons }}
    <div class="column">
      {{ $type := default "input" .type }}
      {{ $class := default "input" .class }}
      <div class="control">
        <button class="{{ $class }}"
                type="{{ $type }}"
                {{ with .id }}id="{{ . }}"{{ end }}
                placeholder="{{ default .placeholder (T .placeholder) }}"
                data-name="{{ .name }}"
                {{ with .target_action }}data-target-action="{{ . }}"{{ end }}
                >
          {{ default .title (T .title) }}
        </button>
      </div>
    </div>
    {{ end }}
  </div>

  {{ with .submitted }}
  <div class="submitted">
    {{ if .choices }}
      {{ range .choices }}
      <div class="submitted-choice{{ with .class }} {{ . }}{{ end }}">
        {{ with .title }}
        <h2 class="title">{{ default . (T .) }}</h2>
        {{ end }}
        <div class="content">
          {{ default .body (T .body) | markdownify }}
        </div>
        {{ with .cta }}
        <div class="cta">
          {{ if .title }}
          <a class="button is-rounded {{ default "is-primary is-outlined" .class }}" href="{{ .url | relLangURL }}"
            {{ with .target }}target="{{ . }}" {{ end }}>
            {{ default .title (T .title) }}
          </a>
          {{ end }}
          {{ range .buttons }}
          <a class="button is-rounded {{ default "is-primary is-outlined" .class }}" href="{{ .url | relLangURL }}"
            target="_blank">
            {{ default .title (T .title) }}
          </a>
          {{ end }}
          {{ with .subcta }}
          <div class="subcta">
            {{ default .body (T .body) | markdownify }}
            {{ with .link }}<a class="is-subcta-link{{ with .class }} {{ . }}{{ end }}" href="{{ .url }}">{{ default .body (T .body) }}</a>{{ end }}
          </div>
          {{ end }}
        </div>
        {{ end }}
      </div>
      {{ end }}
    {{ else }}
    {{ with .title }}
    <h2 class="title">{{ default . (T .) }}</h2>
    {{ end }}
    <div class="content">
      {{ default .body (T .body) | markdownify }}
    </div>
    {{ with .cta }}
    <div class="cta">
      {{ if .title }}
      <a class="button is-rounded {{ default "is-primary is-outlined" .class }}" href="{{ .url | relLangURL }}"
        {{ with .target }}target="{{ . }}" {{ end }}>
        {{ default .title (T .title) }}
      </a>
      {{ end }}
      {{ range .buttons }}
      <a class="button is-rounded {{ default "is-primary is-outlined" .class }}" href="{{ .url | relLangURL }}"
        target="_blank">
        {{ default .title (T .title) }}
      </a>
      {{ end }}
      {{ with .subcta }}
      <div class="subcta">
        {{ with .body }}{{ default . (T .) }}{{ end }}
        {{ with .link }}<a class="is-subcta-link{{ with .class }} {{ . }}{{ end }}" href="{{ .url }}">{{ default .body (T .body) }}</a>{{ end }}
      </div>
      {{ end }}
    </div>
    {{ end }}
    {{ end }}
  </div>
  {{ end }}

  {{ range $key, $value := .hidden_values }}
  <input type="hidden" name="{{ $key }}" value="{{ $value }}"></input>
  {{ end }}
</form>
